#!/usr/bin/python
# -*- coding: utf-8 -*-

# LinacSimulator.py
# This file is part of tango-ds (http://sourceforge.net/projects/tango-ds/)
#
# tango-ds is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# tango-ds is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with tango-ds.  If not, see <http://www.gnu.org/licenses/>.

'''Simulation of the PLC1 for the Linac control at ALBA.
'''

from numpy import array,uint8

#Read the 20130604_172208 from the real linac to become a sample for the simulator
memoryMap = array(#read segment
             [0x00,0x00,0x00,0x00,#000 GUN_Filament_V
              0x3d,0x6d,0x08,0x00,#004 GUN_Filament_I
              0x41,0xf0,0x48,0x4f,#008 GUN_Kathode_V
              0x41,0xcc,0xa1,0x2d,#012 GUN_Kathode_T
              0x00,0x00,0x00,0x00,#016
              0x00,0x00,0x00,0x00,#020
              0x00,0x00,0x00,0x00,#024
              0x00,0x00,0x00,0x00,#028
              0x3d,0x78,0x74,0xc7,#032 GUN_HV_V
              0x3e,0x31,0xc6,0x00,#036 GUN_HV_I
              0x43,0x0a,0x05,0x58,#040 PHS1_Phase
              0x00,0x00,0x00,0x00,#044
              0x40,0x2c,0x84,0xb4,#048 SF6_P1
              0x40,0x33,0x00,0x00,#052 SF6_P2
              0xc1,0x31,0x37,0xab,#056 PHS2_Phase
              0xbd,0x7f,0x8b,0xdf,#060 ATT2_P
              0x00,0x00,0x00,0x00,#064
              0b00000100,#068 DI_0to7
              #0:TB_ST 4:A0_ST 5: RFS_ST
              0b11100000,#069 DI_8to15 not used
              0b11000000,#070 DI_16to23
              #0:EG_ENB 1: KA_ENB 2:TL_VOK 5IU_RDY 6:W1_UF 7:W2_UF
              0b10001111,#071 DI_24to31
              #0:W2_UF 1:RL1_UF 2:RL2_UF 3:RL3_UF
              #4:UT_IS 5:MG_IS  6:GM_IS  7:LO_VOK
              0b00001010,#072 DI_Comm 0:HeartBeat
              #0:PLC1_HB 2:PLC1_PR(not-ds) 4:PLC1_PS(not-ds)
              0b00000011,#073 DI_ITLK_L
              #0:SF6P1_ST 1:SF6P2_ST 2:KA1_EN 3:KA2_EN 4:LI_RDY 5:RF_ENB
              0x01,#074 Gun_HV_ST
              0x01,#075 Gun_ST
              0x02,#076 SCM1_ST
              0x02,#077 SCM2_ST
              0x02,#078 SCM3_ST
              0x02,#079 PHS1_ST
              0x05,#080 PHS2_ST
              0x05,#081 ATT2_ST
              0x01,#082 Lock_ST
              0x00,#083 
              0x40,0xc9,0x99,0x9a,#084 EG_FVS (not-ds)
              0x41,0xa7,0xff,0xee,#088 EG_KVS (not-ds)
              0x00,0x00,0x00,0x00,#092 
              0x00,0x00,0x00,0x00,#096 
              0xc2,0xb3,0xff,0xff,#100 GUN_HV_V_setpoint
              0xc1,0x76,0x66,0x5e,#104 TB_GPA
              0x43,0x0a,0x00,0x00,#108 PHS1_PS (not-ds)
              0x43,0xd9,0x80,0x00,#112 A0_OP
              0x43,0x0e,0x00,0x00,#116 TPS0_Phase
              0x42,0x8c,0x00,0x00,#120 TPS1_Phase
              0x43,0x09,0x00,0x00,#124 TPS2_Phase
              0x43,0x11,0x00,0x00,#128 TPSX_Phase
              0x00,0x00,0x00,0x00,#132
              0x00,0x00,0x00,0x00,#136
              0x42,0xfe,0x00,0x00,#140 PHS2_PS (not-ds)
              0xc0,0x39,0x99,0xb0,#144 ATT2_PS (not-ds)
              0x00,0x31,#148 TB_KA1_Delay
              0x0a,0xa0,#150 TB_KA2_Delay
              0x07,0x80,#152 TB_RF2_Delay
              0x0c,0x60,#154 TB_Gun_Delay
              0x00,0x40,#156 TB_GPI
              0x00,0x08,#158 TB_GPN
              0x00,0x02,#160 TB_GPM
              0x01,#162 DO_0to7
              #0:TB_MBM 2:GUN_HV_ONC 3:Interlock_RC 5:GUN_LV_ONC
              0x00,#163 DO_8to15
              #0:SM1_DC 1:SM2_DC 2:SM3_DC 3:SM1_LC 4:SM2_LC 5:SM3_LC
              0x01 #164 Local_lock 0:localCtrl
             ],dtype=uint8)
#             #write segment
#             [0x00,0x00,0x00,0x00,#000
#              0x3d,0x6d,0x08,0x00,#004
#              0x41,0xf0,0x48,0x4f,#008
#              0x41,0xcc,0xa1,0x2d,#012
#              0x00,0x00,0x00,0x00,#016
#              0x00,0x00,0x00,0x00,#020
#              0x00,0x00,0x00,0x00,#024
#              0x00,0x00,0x00,0x3d,#028
#              0x78,0x74,0xc7,0x3e,#032
#              0x31,0xc6,0x00,0x43,#036
#              0x0a,0x05,0x58,0x00,#040
#              0x00,0x00,0x00,0x40,#044
#              0x2c,0x84,0xb4,0x40,#048
#              0x33,0x00,0x00,0xc1,#052
#              0x31,0x37,0xab,0x7f,#056
#              0x8b,0xdf,0x00,0x00,#060
#              0x00,0x04,#064
#              0xe0,0xc0,#066
#              0x8f,0x0a,#068
#              0x03,0x01,#070
#              0x01,0x02,#072
#              0x02,0x02,#074
#              0x02,0x05,#076
#              0x05,#078
#              0x01,#079
#              0x00,#080
#              0x40,#081
#              0xc9,#082
#              0x99,#083
#              0x9a,0x41,0xa7,0xff,#084
#              0xee,0x00,0x00,0x00,#088
#              0x00,0x00,0x00,0x00,#092
#              0xc2,0xb3,0xff,0xff,#096
#              0xc1,0x76,0x66,0x5e,#100
#              0x43,0x0a,0x00,0x00,#104
#              0x43,0xd9,0x80,0x00,#108
#              0x43,0x0e,0x00,0x00,#112
#              0x42,0x8c,0x00,0x00,#116
#              0x43,0x09,0x00,0x00,#120
#              0x43,0x11,0x00,0x00,#124
#              0x00,0x00,0x00,0x00,#128
#              0x00,0x00,0x00,0x00,#132
#              0x42,0xfe,0x00,0x00,#136
#              0xc0,0x39,0x99,0xb0,#140
#              0x00,0x31,0x0a,0xa0,#144
#              0x07,0x80,#148
#              0x0c,0x60,#150
#              0x00,0x40,#152
#              0x00,0x08,#156
#              0x00,0x02,#158
#              0x01,0x00,#160
#              0x01#162
#             ]
#            ]
